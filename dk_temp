RAISERROR('	CREATING OR ALTERING FUNCTION [Infra].[fn_Split]',10,1) WITH NOWAIT;
if object_id('Infra.fn_Split') is null exec('create function [Infra].[fn_Split]() returns table as return (select 1 a)')
GO
  alter function Infra.fn_Split(@Str nvarchar(max),
								@Delimiter varchar(10)) returns table
WITH ENCRYPTION
as
	return
	(select row_number() over (order by Num) ID,
		substring(@Str, Num + datalength(@Delimiter) - datalength(@Delimiter), charindex(@Delimiter, @Str + @Delimiter, Num) - Num) Val
	from Infra.Numbers
	where substring(@Delimiter + @Str, Num, datalength(@Delimiter)) = @Delimiter
		and Num <= len(@Str))

GO
